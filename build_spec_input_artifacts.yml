version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash
env:
  variables:
    "testEnv" : "testVariable"
  exportedVariables:
    - VERS
    - param1
    - CONTENTS_ARTIFACT_BY_ID
    - CONTENTS_ARTIFACT_BY_PATH

inputArtifacts:
  - name: generic-artifact-by-id
    type: GENERIC_ARTIFACT
    artifactId: ${ARTIFACT_ID} ## Ex: ocid1.genericartifact.oc1.iad.0.amaaaaaajethd5aal242ohxcokvdfdmrjp3oavmlrqgik5mh5xsstjq5v7ka
    location: file.exe
  - name: generic-artifact-by-path
    type: GENERIC_ARTIFACT
    registryId: ocid1.artifactrepository.oc1.iad.0.amaaaaaajethd5aapye7qhostprgldy5meh4qdl34zoghjiy7pc5ife2rsfa
    path: internal-lib.jar
    version: ${ARTIFACT_VERSION}
    location: ${OCI_WORKSPACE_DIR}/libs/internal-lib.jar

steps:
  - type: Command
    name: "Maven build step"
    command: |
      echo "Hello build stage"
      mvn clean install
  - type: Command
    name: "Export artifact contents"
    command: |
      cat artifactById.txt && export CONTENTS_ARTIFACT_BY_ID=`cat artifactById.txt`
      cat ${ARTIFACT_DOWNLOAD_PATH} && export CONTENTS_ARTIFACT_BY_PATH=`cat ${ARTIFACT_DOWNLOAD_PATH}`

outputArtifacts:
  - name: FILE_ARTIFACT_BY_ID
    type: BINARY
    location: artifactById.txt
  - name: FILE_ARTIFACT_BY_PATH
    type: BINARY
    location: artifactByPath.txt
      
